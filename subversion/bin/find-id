#! /usr/bin/perl

# $Id: find-id 493 2007-02-26 11:52:26Z genehack $

use strict;
use warnings;

use Cwd;
use File::Basename;
use File::Find;
use File::Slurp;

my $progname = fileparse( $0 );

my $dir = getcwd;

if ( my $newdir = shift ) {
  if ( -d $newdir ) {
    $dir = $newdir;
    chdir $dir;
  }
  elsif ( -e $newdir ) {
    die "$progname: $newdir: not a dir\n";
  }
  else {
    die "$progname: $newdir: no such dir\n";
  }
}

$dir =~ s|/$|| if $dir =~ m|/$|;

find(\&wanted , $dir );

# wanted
sub wanted {
  # skip dotfiles
  return if /^\./;
  # skip emacs swap files
  return if /^\#.*\#$/;
  return if /~$/;
  # skip directories
  return if -d;

  # skip everything in a .svn tree
  return if $File::Find::name =~ m|/\.svn/|;

  # if we got to this point, it's a file we're interested in scanning for
  # FIXME indicators, so generate a relative filename for later output
  my $masked_name = $File::Find::name;
  $masked_name =~ s/$dir/./;

  # then slurp in the file, look for matches, and print them out
  foreach my $line ( read_file( $_ )) {
    if ( $line =~ /\$Id\$/ ) {
      printf "%-40s\n" , $masked_name;
    }
  }
} #/wanted
